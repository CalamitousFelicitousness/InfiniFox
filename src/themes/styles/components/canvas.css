/**
 * InfiniFox Canvas Styles
 * Canvas component styling using design tokens
 */

/* ==========================================
   Canvas Container
   ========================================== */

.canvas-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background-color: var(--color-background-canvas);
  
  /* Grid pattern background */
  &.show-grid {
    background-image: 
      linear-gradient(var(--custom-canvas-grid-color) 1px, transparent 1px),
      linear-gradient(90deg, var(--custom-canvas-grid-color) 1px, transparent 1px),
      linear-gradient(var(--custom-canvas-grid-color-strong) 2px, transparent 2px),
      linear-gradient(90deg, var(--custom-canvas-grid-color-strong) 2px, transparent 2px);
    background-size: 
      20px 20px,
      20px 20px,
      100px 100px,
      100px 100px;
    background-position:
      0 0,
      0 0,
      0 0,
      0 0;
  }
  
  /* Dot grid pattern */
  &.show-dots {
    background-image: radial-gradient(circle, var(--custom-canvas-grid-color) 1px, transparent 1px);
    background-size: 20px 20px;
  }
  
  /* Performance optimizations */
  will-change: transform;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* ==========================================
   Konva Stage Container
   ========================================== */

.konva-stage-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  cursor: crosshair;
  touch-action: none;
  
  /* Drawing mode cursors */
  &.tool-brush { cursor: crosshair; }
  &.tool-eraser { cursor: crosshair; }
  &.tool-move { cursor: move; }
  &.tool-select { cursor: default; }
  &.tool-zoom { cursor: zoom-in; }
  &.tool-hand { cursor: grab; }
  
  &.tool-hand.dragging { cursor: grabbing; }
  
  /* Disable default touch behaviors */
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  overscroll-behavior: none;
}

/* ==========================================
   Canvas Overlay Elements
   ========================================== */

.canvas-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: var(--z-overlay);
  
  &.interactive {
    pointer-events: auto;
  }
}

/* ==========================================
   Canvas Selection
   ========================================== */

.canvas-selection {
  position: absolute;
  border: 2px dashed var(--color-primary-500);
  background-color: var(--custom-canvas-selection-opacity);
  pointer-events: none;
  animation: var(--animation-pulse-slow);
  
  .selection-handle {
    position: absolute;
    width: 8px;
    height: 8px;
    background-color: var(--color-gray-1000);
    border: 2px solid var(--color-primary-500);
    border-radius: var(--radius-sm);
    pointer-events: auto;
    cursor: pointer;
    
    &.nw { top: -4px; left: -4px; cursor: nwse-resize; }
    &.ne { top: -4px; right: -4px; cursor: nesw-resize; }
    &.sw { bottom: -4px; left: -4px; cursor: nesw-resize; }
    &.se { bottom: -4px; right: -4px; cursor: nwse-resize; }
    &.n { top: -4px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
    &.s { bottom: -4px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
    &.w { left: -4px; top: 50%; transform: translateY(-50%); cursor: ew-resize; }
    &.e { right: -4px; top: 50%; transform: translateY(-50%); cursor: ew-resize; }
  }
}

/* ==========================================
   Canvas Minimap
   ========================================== */

.canvas-minimap {
  position: absolute;
  bottom: var(--spacing-4);
  right: var(--spacing-4);
  width: 200px;
  height: 150px;
  background: var(--custom-glass-bg);
  backdrop-filter: blur(var(--custom-glass-blur));
  -webkit-backdrop-filter: blur(var(--custom-glass-blur));
  border: 1px solid var(--custom-glass-border);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-panel-default);
  overflow: hidden;
  z-index: var(--z-sticky);
  transition: var(--transition-opacity);
  
  &.collapsed {
    width: 40px;
    height: 40px;
    cursor: pointer;
    
    .minimap-content {
      display: none;
    }
    
    .minimap-toggle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  }
  
  .minimap-content {
    position: relative;
    width: 100%;
    height: 100%;
    
    canvas {
      width: 100%;
      height: 100%;
      image-rendering: pixelated;
    }
    
    .minimap-viewport {
      position: absolute;
      border: 2px solid var(--color-primary-500);
      background-color: var(--custom-canvas-selection-opacity);
      pointer-events: none;
    }
  }
  
  .minimap-toggle {
    position: absolute;
    top: var(--spacing-1);
    right: var(--spacing-1);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-surface-primary);
    border: var(--border-default);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: var(--transition-all);
    
    &:hover {
      background-color: var(--color-surface-hover);
      border-color: var(--color-primary-400);
    }
  }
}

/* ==========================================
   Canvas Context Menu
   ========================================== */

.canvas-context-menu {
  position: fixed;
  min-width: 180px;
  background: var(--custom-glass-bg);
  backdrop-filter: blur(var(--custom-glass-blur));
  -webkit-backdrop-filter: blur(var(--custom-glass-blur));
  border: 1px solid var(--custom-glass-border);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-dropdown-default);
  padding: var(--spacing-1);
  z-index: var(--z-dropdown);
  animation: var(--animation-scale-in);
  
  .context-menu-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    padding: var(--spacing-2) var(--spacing-3);
    border-radius: var(--radius-sm);
    color: var(--color-text-primary);
    font-size: var(--font-size-sm);
    cursor: pointer;
    transition: var(--transition-colors);
    
    &:hover {
      background-color: var(--color-surface-hover);
    }
    
    &.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    &.destructive {
      color: var(--color-error-500);
      
      &:hover {
        background-color: var(--color-error-50);
      }
    }
    
    .context-menu-icon {
      width: 16px;
      height: 16px;
      opacity: 0.7;
    }
    
    .context-menu-shortcut {
      margin-left: auto;
      font-size: var(--font-size-xs);
      color: var(--color-text-tertiary);
    }
  }
  
  .context-menu-separator {
    height: 1px;
    background-color: var(--color-border-secondary);
    margin: var(--spacing-1) 0;
  }
}

/* ==========================================
   Canvas Loading State
   ========================================== */

.canvas-loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-3);
  
  .loading-spinner {
    width: 48px;
    height: 48px;
    border: 3px solid var(--color-surface-primary);
    border-top-color: var(--color-primary-500);
    border-radius: 50%;
    animation: var(--animation-spin);
  }
  
  .loading-text {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }
  
  .loading-progress {
    width: 200px;
    height: 4px;
    background-color: var(--color-surface-primary);
    border-radius: var(--radius-full);
    overflow: hidden;
    
    .progress-bar {
      height: 100%;
      background-color: var(--color-primary-500);
      border-radius: var(--radius-full);
      transition: width var(--transition-smooth);
    }
  }
}

/* ==========================================
   Image Size Indicator
   ========================================== */

.image-size-indicator {
  position: absolute;
  padding: var(--spacing-1) var(--spacing-2);
  background: var(--custom-glass-bg);
  backdrop-filter: blur(var(--custom-glass-blur));
  -webkit-backdrop-filter: blur(var(--custom-glass-blur));
  border: 1px solid var(--custom-glass-border);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  color: var(--color-text-primary);
  pointer-events: none;
  z-index: var(--z-tooltip);
  white-space: nowrap;
}

/* ==========================================
   Canvas Rulers
   ========================================== */

.canvas-rulers {
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: var(--z-base);
  
  .ruler-horizontal {
    position: absolute;
    top: 0;
    left: 30px;
    right: 0;
    height: 30px;
    background: var(--color-surface-primary);
    border-bottom: var(--border-subtle);
    overflow: hidden;
  }
  
  .ruler-vertical {
    position: absolute;
    top: 30px;
    left: 0;
    bottom: 0;
    width: 30px;
    background: var(--color-surface-primary);
    border-right: var(--border-subtle);
    overflow: hidden;
  }
  
  .ruler-corner {
    position: absolute;
    top: 0;
    left: 0;
    width: 30px;
    height: 30px;
    background: var(--color-surface-secondary);
    border-right: var(--border-subtle);
    border-bottom: var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-size-xs);
    color: var(--color-text-tertiary);
  }
  
  .ruler-marks {
    position: relative;
    width: 100%;
    height: 100%;
    
    .ruler-mark {
      position: absolute;
      background-color: var(--color-text-tertiary);
      
      &.major {
        opacity: 0.5;
      }
      
      &.minor {
        opacity: 0.3;
      }
    }
    
    .ruler-label {
      position: absolute;
      font-size: 10px;
      color: var(--color-text-tertiary);
      user-select: none;
    }
  }
}

/* ==========================================
   Canvas Guides
   ========================================== */

.canvas-guides {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: var(--z-base);
  
  .guide {
    position: absolute;
    background-color: var(--color-primary-500);
    opacity: 0.5;
    
    &.horizontal {
      left: 0;
      right: 0;
      height: 1px;
    }
    
    &.vertical {
      top: 0;
      bottom: 0;
      width: 1px;
    }
    
    &.dragging {
      opacity: 1;
      box-shadow: var(--shadow-glow-sm);
    }
  }
}

/* ==========================================
   Responsive Adjustments
   ========================================== */

/* Small screens */
@media (max-width: 640px) {
  .canvas-minimap {
    width: 120px;
    height: 90px;
    bottom: var(--spacing-2);
    right: var(--spacing-2);
  }
  
  .canvas-context-menu {
    min-width: 160px;
    font-size: var(--font-size-xs);
  }
}

/* Touch optimizations */
@media (hover: none) and (pointer: coarse) {
  .canvas-selection .selection-handle {
    width: 12px;
    height: 12px;
  }
  
  .canvas-context-menu .context-menu-item {
    padding: var(--spacing-3) var(--spacing-4);
    min-height: 44px;
  }
}

/* High DPI screens */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .canvas-container.show-grid {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
}
